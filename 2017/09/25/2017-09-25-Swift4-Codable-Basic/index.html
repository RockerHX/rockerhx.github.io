<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    
    <title>Swift4 终极解析方案：基础篇 | Andy矢倉</title>
    <meta name="renderer" content="webkit">
    <meta name="HandheldFriendly" content="True">
    <meta name="MobileOptimized" content="320">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

    <meta name="description" content="曾梦想 仗贱走天涯 看尽女人和繁华">

    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="Swift4 终极解析方案：基础篇 | Andy矢倉">
    <meta name="twitter:description" content="曾梦想 仗贱走天涯 看尽女人和繁华">

    <meta property="og:type" content="article">
    <meta property="og:title" content="Swift4 终极解析方案：基础篇 | Andy矢倉">
    <meta property="og:description" content="曾梦想 仗贱走天涯 看尽女人和繁华">

    
    <meta name="author" content="Andy矢倉">
    
    <link rel="stylesheet" href="/css/vno.css">
    <link rel="stylesheet" href="//netdna.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css">

    
    <link rel="icon" href="/images/avatar-small.jpg">
    

    <meta name="generator" content="hexo"/>
    
    <link rel="alternate" type="application/rss+xml" title="Andy矢倉" href="/atom.xml">
    

    <link rel="canonical" href="http://rockerhx.github.io/2017/09/25/2017-09-25-Swift4-Codable-Basic/"/>

                 
</head>

<body class="home-template no-js">
    <script src="//cdn.bootcss.com/jquery/2.1.4/jquery.min.js"></script>
    <script src="/js/main.js"></script>
    <span class="mobile btn-mobile-menu">
        <i class="fa fa-list btn-mobile-menu__icon"></i>
        <i class="fa fa-angle-up btn-mobile-close__icon hidden"></i>
    </span>

    
<header class="panel-cover panel-cover--collapsed" style="background-image: url(/images/background-cover.jpg)">
  <div class="panel-main">
    <div class="panel-main__inner panel-inverted">
    <div class="panel-main__content">

        <a href="/" title="前往 Andy矢倉 的主页"><img src="/images/avatar.jpg" width="80" alt="Andy矢倉 logo" class="panel-cover__logo logo" /></a>
        <h1 class="panel-cover__title panel-title"><a href="/" title="link to homepage for Andy矢倉">Andy矢倉</a></h1>
        
        <span class="panel-cover__subtitle panel-subtitle">老板 来杯董小姐 去冰 少糖 多放点小姐</span>
        
        <hr class="panel-cover__divider" />
        <p class="panel-cover__description">曾梦想 仗贱走天涯 看尽女人和繁华</p>
        <hr class="panel-cover__divider panel-cover__divider--secondary" />

        <div class="navigation-wrapper">
          <div>
          <nav class="cover-navigation cover-navigation--primary">
            <ul class="navigation">
              <li class="navigation__item"><a href="/#blog" title="访问博客" class="blog-button">博客</a></li>
            
              <li class="navigation__item"><a href="/">主页</a></li>
            
              <li class="navigation__item"><a href="/archives">所有文章</a></li>
            
            </ul>
          </nav>
          </div>
          <div>
          <nav class="cover-navigation navigation--social">
  <ul class="navigation">

  <!-- Weibo-->
  
  <li class="navigation__item">
    <a href="http://weibo.com/ganmaojijie" title="我的微博" target="_blank">
      <i class='social fa fa-weibo'></i>
      <span class="label">Weibo</span>
    </a>
  </li> 


  <!-- Github -->
  
  <li class="navigation__item">
    <a href="https://github.com/rockerhx" title="查看我的GitHub主页" target="_blank">
      <i class='social fa fa-github'></i>
      <span class="label">Github</span>
    </a>
  </li>


<!-- Stack Overflow -->
        

  <!-- Google Plus -->
  

<!-- Facebook -->

  
<!-- Twitter -->

  <li class="navigation__item">
    <a href="https://twitter.com/rockerhx" title="上Twitter找我" target="_blank">
      <i class='social fa fa-twitter'></i>
      <span class="label">Twitter</span>
    </a>
  </li>

  

  <li class="navigation__item">
    <a href="/atom.xml" title="RSS" target="_blank">
      <i class='social fa fa-rss'></i>
      <span class="label">RSS</span>
    </a>
  </li>


  <li class="navigation__item">
    <a href="mailto:rockerhx@gmail.com" title="邮件联系我" target="_blank">
      <i class='social fa fa-envelope'></i>
      <span class="label">Email</span>
    </a>
  </li>


  </ul>
</nav>

          </div>
        </div>

      </div>

    </div>

    <div class="panel-cover--overlay cover-purple"></div>
  </div> 
</header>

    <div class="content-wrapper">
        <div class="content-wrapper__inner">
            <article class="post-container post-container--single">

  <header class="post-header">
    <div class="post-meta">
      <time datetime="2017-09-24T17:57:11.000Z" class="post-list__meta--date date">9月 25 2017</time> &#8226; <span class="post-meta__tags tags">于&nbsp;
  <a class="tag-link" href="/tags/Codable/">Codable</a>, <a class="tag-link" href="/tags/JSON/">JSON</a>, <a class="tag-link" href="/tags/Swift4/">Swift4</a>
 </span>
      <span class="page-pv">
      &nbsp;阅读&nbsp;<span id="busuanzi_value_page_pv"><i class="fa fa-spinner fa-spin"></i></span>
      </span> 
   
    </div>
    <h1 class="post-title">Swift4 终极解析方案：基础篇</h1>
  </header>

  <section class="post">
    <blockquote>
<p>做过网络开发，特别是互联网，甚至移动端开发的，日常对于数据解析，早年主流的<code>XML</code>，现今主流的<code>JSON</code>都是非常熟悉的，说道解析，系统自带和各种第三方的解析库，除了解析当然也当不了懒癌的脚步，各种model反射库。<br>对于<code>Objective-C</code>各种方案都尤为成熟，甚至还有专门的MacApp用于model生成，可以说是懒到极致，好处当然是节省出了撸猫撸手办的时间（技术狗撸手办不知道是什么时候开始的恶习，我还是更喜欢撸妹纸）。<br>这种操作对于<code>Swift</code>就比较蛋疼了，当然第三方库和工具也是完全够用，但是，生成的model里面一大堆代码，一个字，恶心。</p>
</blockquote>
<p>那好，今年Swift更新到4.0版本之后带了一个我最喜欢的功能：<a href="https://developer.apple.com/documentation/swift/codable" target="_blank" rel="noopener">Codable</a>协议。</p>
<blockquote>
<p><code>Codable</code>是<a href="https://developer.apple.com/documentation/swift/encodable" target="_blank" rel="noopener">Encodable</a>和<a href="https://developer.apple.com/documentation/swift/decodable" target="_blank" rel="noopener">Decodable</a>协议总和的别名。所以它既能编码也能解码，自从有了它，我model里面代码奏是干干净净，清清爽爽，对于洁癖控来说，这货是原生的，又可以少个<code>Pod</code>和<code>Package</code>了，巴巴掌。</p>
</blockquote>
<h2 id="开始吧"><a href="#开始吧" class="headerlink" title="开始吧"></a>开始吧</h2><p>如果对此协议不太明白到底能干啥，可以先看下今年的<a href="https://developer.apple.com/videos/play/wwdc2017/212/" target="_blank" rel="noopener">WWDC</a>视频。</p>
<p><code>Codable</code>让我们可以通过<code>Struct</code>和<code>Class</code>不要一行多余代码来解析<code>JSON</code>和<code>Plist</code>数据。基础库简直嗨的不要不要的。<br>让我们来看一个例子：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">import Foundation</span><br><span class="line">struct Swifter: Decodable &#123;</span><br><span class="line">  let fullName: String</span><br><span class="line">  let id: Int</span><br><span class="line">  let twitter: URL</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">let json = &quot;&quot;&quot;</span><br><span class="line">&#123;</span><br><span class="line">	&quot;fullName&quot;: &quot;Federico Zanetello&quot;,</span><br><span class="line">	&quot;id&quot;: 123456,</span><br><span class="line">	&quot;twitter&quot;: &quot;http://twitter.com/zntfdr&quot;</span><br><span class="line">&#125;</span><br><span class="line">&quot;&quot;&quot;.data(using: .utf8)! // our data in native (JSON) format</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">let myStruct = try JSONDecoder().decode(Swifter.self, from: json) // Decoding our data</span><br><span class="line">print(myStruct) // decoded!!!!!</span><br></pre></td></tr></table></figure>
<p>如果你看过<a href="https://developer.apple.com/documentation/swift/decodable" target="_blank" rel="noopener">Decodable文档</a>，那你肯定知道里面有一个必须实现的方法<code>init(from: Decoder)</code>。然而示例里并没实现，照样跑得飞起来，那就是苹果爸爸妈宝当到家：编译器默认会帮我们实现一个。</p>
<p>再看看另外一个例子：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">import Foundation</span><br><span class="line">enum BeerStyle : String, Codable &#123;</span><br><span class="line">    case ipa</span><br><span class="line">    case stout</span><br><span class="line">    case kolsch</span><br><span class="line">    // ...</span><br><span class="line">&#125;</span><br><span class="line">struct Beer &#123;</span><br><span class="line">    let name: String</span><br><span class="line">    let brewery: String</span><br><span class="line">    let style: BeerStyle</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">let json = &quot;&quot;&quot;</span><br><span class="line">&#123;</span><br><span class="line">	&quot;name&quot;: &quot;Endeavor&quot;,</span><br><span class="line">	&quot;abv&quot;: 8.9,</span><br><span class="line">	&quot;brewery&quot;: &quot;Saint Arnold&quot;,</span><br><span class="line">	&quot;style&quot;: &quot;ipa&quot;</span><br><span class="line">&#125;</span><br><span class="line">&quot;&quot;&quot;.data(using: .utf8)! // our data in native (JSON) format</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">let myStruct = try JSONDecoder().decode(Swifter.self, from: json) // Decoding our data</span><br><span class="line">print(myStruct) // decoded!!!!!</span><br></pre></td></tr></table></figure>
<blockquote>
<p>看到这里是不是就被戳到G点了？？？如果后端没有啥特别的字段，你只需要把<code>JSON</code>里的<code>Key</code>作为<code>Property</code>即可。<br>解析的条件就是，只要是系统提供的如<code>String</code>，<code>number</code>，<code>Bool</code>以及各类集合，只要是符合<code>Decodable</code>协议即可，简直是嗨到极点。</p>
</blockquote>
<h2 id="自定义实现"><a href="#自定义实现" class="headerlink" title="自定义实现"></a>自定义实现</h2><p>能够直接解析当然是最好的，但是往往开发的时候会遇到一些比较复杂的结构，那可能是<code>Array</code>和<code>Dictionary</code>相互嵌套，各个系统或者开发语言的保留字导致字段奇特，以及很多煞笔后端搞些魔术字啊，拼音命名的字段啥的。</p>
<p><img src="http://upload-images.jianshu.io/upload_images/311224-3f590cd3fcdbc055.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>实际上开发大多遇到的都是这种情况，那就不得不出动自定义解析了。自定义的部分稍微复杂点，坐稳了别翻车。</p>
<h3 id="解码器"><a href="#解码器" class="headerlink" title="解码器"></a>解码器</h3><p><a href="https://developer.apple.com/documentation/swift/decoder" target="_blank" rel="noopener">Decoder</a>负责处理<code>JSON</code>和<code>Plist</code>解析工作，需要重点关注的两个方法：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">public func container&lt;Key&gt;(keyedBy type: Key.Type) throws -&gt; KeyedDecodingContainer&lt;Key&gt; where Key : CodingKey</span><br><span class="line">public func singleValueContainer() throws -&gt; SingleValueDecodingContainer</span><br></pre></td></tr></table></figure></p>
<p>这两个方法返回的都是<code>Container</code>。<br>第一个方法返回<a href="https://developer.apple.com/documentation/swift/codingkey" target="_blank" rel="noopener"><em>keyed</em></a><code>Container</code>，<a href="https://developer.apple.com/documentation/swift/keyeddecodingcontainer" target="_blank" rel="noopener">KeyedDecodingContainer</a>：如果我们要自定义解析，那就需要告诉解码器如何映射。<br>第二个方法仅仅返回一个<code>Container</code>，而<a href="https://developer.apple.com/documentation/swift/singlevaluedecodingcontainer" target="_blank" rel="noopener">SingleValueDecodingContainer</a>里的数据正是我们想要的。</p>
<h3 id="容器"><a href="#容器" class="headerlink" title="容器"></a>容器</h3><p><code>Decoder</code>提供了基础的功能解析原始数据，自定义数据就需要我们自己来搞定。<br><code>KeyedDecodingContainer</code>：我们的容器是通过键值匹配的，所以大可以看作<code>[Key: Any]</code>这样的字典结构。<br>不同的键对应不同的类型数据，所以容器提供的不同解码方法：<code>decode(Type:forKey:)</code>。<br>它的神奇之处就在于容器会自动匹配数据类型。<br>当然，解码器也提供了通用方法：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">public func decode&lt;T&gt;(_ type: T.Type, forKey key: KeyedDecodingContainer.Key) throws -&gt; T where T : Decodable</span><br></pre></td></tr></table></figure></p>
<p>有了这个泛型解析方法，那就意味着任意类型都可以匹配解析。</p>
<p><code>SingleValueDecodingContainer</code>就更前面说的一样，只考虑返回。</p>
<h3 id="实现"><a href="#实现" class="headerlink" title="实现"></a>实现</h3><p>前面基础已经铺垫完了，现在就不要编译器帮忙了，我们自己手动来实现<code>init(from: Decoder)</code>。</p>
<h4 id="第一步：选择正确的解码器"><a href="#第一步：选择正确的解码器" class="headerlink" title="第一步：选择正确的解码器"></a>第一步：选择正确的解码器</h4><p>示例里是<code>JSON</code>对象，那我们就选择<a href="https://github.com/apple/swift/blob/dbe77601f348583eb892a5b9fff09327e23b00c2/stdlib/public/SDK/Foundation/JSONEncoder.swift#L789" target="_blank" rel="noopener">JSONDecoder</a>。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">let decoder = JSONDecoder()</span><br></pre></td></tr></table></figure></p>
<p><code>JSON</code>和<code>Plist</code>解析器都是系统内置的，如果你想要，你也可以自己实现一个解析器解析你够奇葩的数据。</p>
<h4 id="第二步：选择正确的容器"><a href="#第二步：选择正确的容器" class="headerlink" title="第二步：选择正确的容器"></a>第二步：选择正确的容器</h4><p>JSON数据如下：<br><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">	<span class="attr">"fullName"</span>: <span class="string">"Federico Zanetello"</span>,</span><br><span class="line">	<span class="attr">"id"</span>: <span class="number">123456</span>,</span><br><span class="line">	<span class="attr">"twitter"</span>: <span class="string">"http://twitter.com/zntfdr"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>其实按照最开始说的，这个对象可以直接反射，辣么我们这里讲的自定义，那就按照自定义的套路走，我们按要求实现一个<code>String</code>的<code>结构体</code>，并且满足<code>CodingKey</code>协议：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">enum MyStructKeys: String, CodingKey &#123;</span><br><span class="line">  case fullName = &quot;fullName&quot;</span><br><span class="line">  case id = &quot;id&quot;</span><br><span class="line">  case twitter = &quot;twitter&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>接下来创建容器：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">let container = try decoder.container(keyedBy: MyStructKeys.self)</span><br></pre></td></tr></table></figure></p>
<h4 id="第三步：提取数据"><a href="#第三步：提取数据" class="headerlink" title="第三步：提取数据"></a>第三步：提取数据</h4><p>这里我们需要做类型转换：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">let fullName: String = try container.decode(String.self, forKey: .fullName)</span><br><span class="line">let id: Int = try container.decode(Int.self, forKey: .id)</span><br><span class="line">let twitter: URL = try container.decode(URL.self, forKey: .twitter)</span><br></pre></td></tr></table></figure></p>
<h4 id="第四步：初始化"><a href="#第四步：初始化" class="headerlink" title="第四步：初始化"></a>第四步：初始化</h4><p>使用默认的构造器：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">let myStruct = Swifter(fullName: fullName, id: id, twitter: twitter)</span><br></pre></td></tr></table></figure></p>
<p>现在我们就来看看全部实现：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">import Foundation</span><br><span class="line">struct Swifter &#123;</span><br><span class="line">  let fullName: String</span><br><span class="line">  let id: Int</span><br><span class="line">  let twitter: URL</span><br><span class="line">  </span><br><span class="line">  init(fullName: String, id: Int, twitter: URL) &#123; // default struct initializer</span><br><span class="line">    self.fullName = fullName</span><br><span class="line">    self.id = id</span><br><span class="line">    self.twitter = twitter</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">extension Swifter: Decodable &#123;</span><br><span class="line">  enum MyStructKeys: String, CodingKey &#123; // declaring our keys </span><br><span class="line">    case fullName = &quot;fullName&quot;</span><br><span class="line">    case id = &quot;id&quot;</span><br><span class="line">    case twitter = &quot;twitter&quot;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  init(from decoder: Decoder) throws &#123;</span><br><span class="line">    let container = try decoder.container(keyedBy: MyStructKeys.self) // defining our (keyed) container</span><br><span class="line">    let fullName: String = try container.decode(String.self, forKey: .fullName) // extracting the data</span><br><span class="line">    let id: Int = try container.decode(Int.self, forKey: .id) // extracting the data</span><br><span class="line">    let twitter: URL = try container.decode(URL.self, forKey: .twitter) // extracting the data</span><br><span class="line">    </span><br><span class="line">    self.init(fullName: fullName, id: id, twitter: twitter) // initializing our struct</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">let json = &quot;&quot;&quot;</span><br><span class="line">&#123;</span><br><span class="line">	&quot;fullName&quot;: &quot;Federico Zanetello&quot;,</span><br><span class="line">	&quot;id&quot;: 123456,</span><br><span class="line">	&quot;twitter&quot;: &quot;http://twitter.com/zntfdr&quot;</span><br><span class="line">&#125;</span><br><span class="line">&quot;&quot;&quot;.data(using: .utf8)! // our native (JSON) data</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">let myStruct = try JSONDecoder().decode(Swifter.self, from: json) // decoding our data</span><br><span class="line">print(myStruct) // decoded!</span><br></pre></td></tr></table></figure>
<h2 id="复杂结构处理"><a href="#复杂结构处理" class="headerlink" title="复杂结构处理"></a>复杂结构处理</h2><h3 id="数组"><a href="#数组" class="headerlink" title="数组"></a>数组</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">import Foundation</span><br><span class="line">struct Swifter: Decodable &#123;</span><br><span class="line">  let fullName: String</span><br><span class="line">  let id: Int</span><br><span class="line">  let twitter: URL</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">let json = &quot;&quot;&quot;</span><br><span class="line">[</span><br><span class="line">	&#123;</span><br><span class="line">		&quot;fullName&quot;: &quot;Federico Zanetello&quot;,</span><br><span class="line">		&quot;id&quot;: 123456,</span><br><span class="line">		&quot;twitter&quot;: &quot;http://twitter.com/zntfdr&quot;</span><br><span class="line">	&#125;,</span><br><span class="line">	&#123;</span><br><span class="line">		&quot;fullName&quot;: &quot;Federico Zanetello&quot;,</span><br><span class="line">		&quot;id&quot;: 123456,</span><br><span class="line">		&quot;twitter&quot;: &quot;http://twitter.com/zntfdr&quot;</span><br><span class="line">	&#125;,</span><br><span class="line">	&#123;</span><br><span class="line">		&quot;fullName&quot;: &quot;Federico Zanetello&quot;,</span><br><span class="line">		&quot;id&quot;: 123456,</span><br><span class="line">		&quot;twitter&quot;: &quot;http://twitter.com/zntfdr&quot;</span><br><span class="line">	&#125;</span><br><span class="line">]</span><br><span class="line">&quot;&quot;&quot;.data(using: .utf8)! // our data in native format</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">let myStructArray = try JSONDecoder().decode([Swifter].self, from: json)</span><br><span class="line">myStructArray.forEach &#123; print($0) &#125; // decoded!!!!!</span><br></pre></td></tr></table></figure>
<h3 id="字典"><a href="#字典" class="headerlink" title="字典"></a>字典</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">import Foundation</span><br><span class="line">struct Swifter: Codable &#123;</span><br><span class="line">  let fullName: String</span><br><span class="line">  let id: Int</span><br><span class="line">  let twitter: URL</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">let json = &quot;&quot;&quot;</span><br><span class="line">&#123;</span><br><span class="line">	&quot;one&quot;: &#123;</span><br><span class="line">		&quot;fullName&quot;: &quot;Federico Zanetello&quot;,</span><br><span class="line">		&quot;id&quot;: 123456,</span><br><span class="line">		&quot;twitter&quot;: &quot;http://twitter.com/zntfdr&quot;</span><br><span class="line">	&#125;,</span><br><span class="line">	&quot;two&quot;: &#123;</span><br><span class="line">		&quot;fullName&quot;: &quot;Federico Zanetello&quot;,</span><br><span class="line">		&quot;id&quot;: 123456,</span><br><span class="line">		&quot;twitter&quot;: &quot;http://twitter.com/zntfdr&quot;</span><br><span class="line">	&#125;,</span><br><span class="line">	&quot;three&quot;: &#123;</span><br><span class="line">		&quot;fullName&quot;: &quot;Federico Zanetello&quot;,</span><br><span class="line">		&quot;id&quot;: 123456,</span><br><span class="line">		&quot;twitter&quot;: &quot;http://twitter.com/zntfdr&quot;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line">&quot;&quot;&quot;.data(using: .utf8)! // our data in native format</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">let myStructDictionary = try JSONDecoder().decode([String: Swifter].self, from: json)</span><br><span class="line">myStructDictionary.forEach &#123; print(&quot;\($0.key): \($0.value)&quot;) &#125; // decoded!!!!!</span><br></pre></td></tr></table></figure>
<h3 id="枚举"><a href="#枚举" class="headerlink" title="枚举"></a>枚举</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">import Foundation</span><br><span class="line">struct Swifter: Decodable &#123;</span><br><span class="line">  let fullName: String</span><br><span class="line">  let id: Int</span><br><span class="line">  let twitter: URL</span><br><span class="line">&#125;</span><br><span class="line">enum SwifterOrBool: Decodable &#123;</span><br><span class="line">  case swifter(Swifter)</span><br><span class="line">  case bool(Bool)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">extension SwifterOrBool: Decodable &#123;</span><br><span class="line">  enum CodingKeys: String, CodingKey &#123;</span><br><span class="line">    case swifter, bool</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  init(from decoder: Decoder) throws &#123;</span><br><span class="line">    let container = try decoder.container(keyedBy: CodingKeys.self)</span><br><span class="line">    if let swifter = try container.decodeIfPresent(Swifter.self, forKey: .swifter) &#123;</span><br><span class="line">      self = .swifter(swifter)</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">      self = .bool(try container.decode(Bool.self, forKey: .bool))</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">let json = &quot;&quot;&quot;</span><br><span class="line">[</span><br><span class="line">	&#123;</span><br><span class="line">		&quot;swifter&quot;: &#123;</span><br><span class="line">			&quot;fullName&quot;: &quot;Federico Zanetello&quot;,</span><br><span class="line">			&quot;id&quot;: 123456,</span><br><span class="line">			&quot;twitter&quot;: &quot;http://twitter.com/zntfdr&quot;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;,</span><br><span class="line">	&#123; &quot;bool&quot;: true &#125;,</span><br><span class="line">	&#123; &quot;bool&quot;: false &#125;,</span><br><span class="line">	&#123;</span><br><span class="line">		&quot;swifter&quot;: &#123;</span><br><span class="line">			&quot;fullName&quot;: &quot;Federico Zanetello&quot;,</span><br><span class="line">			&quot;id&quot;: 123456,</span><br><span class="line">			&quot;twitter&quot;: &quot;http://twitter.com/zntfdr&quot;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">]</span><br><span class="line">&quot;&quot;&quot;.data(using: .utf8)! // our native (JSON) data</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">let myEnumArray = try JSONDecoder().decode([SwifterOrBool].self, from: json) // decoding our data</span><br><span class="line">myEnumArray.forEach &#123; print($0) &#125; // decoded!</span><br></pre></td></tr></table></figure>
<h3 id="嵌套结构"><a href="#嵌套结构" class="headerlink" title="嵌套结构"></a>嵌套结构</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">import Foundation</span><br><span class="line">struct Swifter: Decodable &#123;</span><br><span class="line">  let fullName: String</span><br><span class="line">  let id: Int</span><br><span class="line">  let twitter: URL</span><br><span class="line">&#125;</span><br><span class="line">struct MoreComplexStruct: Decodable &#123;</span><br><span class="line">  let swifter: Swifter</span><br><span class="line">  let lovesSwift: Bool</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">let json = &quot;&quot;&quot;</span><br><span class="line">&#123;</span><br><span class="line">	&quot;swifter&quot;: &#123;</span><br><span class="line">		&quot;fullName&quot;: &quot;Federico Zanetello&quot;,</span><br><span class="line">		&quot;id&quot;: 123456,</span><br><span class="line">		&quot;twitter&quot;: &quot;http://twitter.com/zntfdr&quot;</span><br><span class="line">	&#125;,</span><br><span class="line">	&quot;lovesSwift&quot;: true</span><br><span class="line">&#125;</span><br><span class="line">&quot;&quot;&quot;.data(using: .utf8)! // our data in native format</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">let myMoreComplexStruct = try JSONDecoder().decode(MoreComplexStruct.self, from: json)</span><br><span class="line">print(myMoreComplexStruct.swifter) // decoded!!!!!</span><br></pre></td></tr></table></figure>
<h2 id="结尾"><a href="#结尾" class="headerlink" title="结尾"></a>结尾</h2><p>为了避免必要的情况，也为了增强代码的健壮性，我们应该多使用系统的错误处理来避免经常崩溃：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">do &#123;</span><br><span class="line">  let myStruct = try JSONDecoder().decode(Swifter.self, from: json) // do your decoding here</span><br><span class="line">&#125; catch &#123;</span><br><span class="line">  print(error) // any decoding error will be printed here!</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>

  </section>

</article>

<section class="read-more">
           
    
               
            <div class="read-more-item">
                <span class="read-more-item-dim">最近的文章</span>
                <h2 class="post-list__post-title post-title"><a href="/2017/09/26/2017-09-26-Swift4-Codable-Ultimate/" title="Swift4 终极解析方案：进阶篇">Swift4 终极解析方案：进阶篇</a></h2>
                <p class="excerpt">
                
                自定义Key基础篇里面已经介绍了使用CodingKey协议来处理自定义字段的问题，这里我们反向编码来看一下，示例：
12345678let json = &amp;quot;&amp;quot;&amp;quot;&amp;#123;	&amp;quot;name&amp;quot;: &amp;quot;Endeavor&amp;quot;,	&amp;quot;ab
                &hellip;
                </p>
                <div class="post-list__meta"><time datetime="2017-09-26T04:21:11.000Z" class="post-list__meta--date date">9月 26 2017</time> &#8226; <span class="post-list__meta--tags tags">于&nbsp;
  <a class="tag-link" href="/tags/Codable/">Codable</a>, <a class="tag-link" href="/tags/JSON/">JSON</a>, <a class="tag-link" href="/tags/Swift4/">Swift4</a>
</span><a class="btn-border-small" href="/2017/09/26/2017-09-26-Swift4-Codable-Ultimate/">继续阅读</a></div>
                           
            </div>
        
        
               
            <div class="read-more-item">
                <span class="read-more-item-dim">更早的文章</span>
                <h2 class="post-list__post-title post-title"><a href="/2017/07/15/2017-07-10-Begining-CloudKit/" title="滚蛋吧！服务器 · Begining CloudKit">滚蛋吧！服务器 · Begining CloudKit</a></h2>
                <p class="excerpt">
                
                
转载请注明，原文地址：滚蛋吧！服务器 · Begining CloudKit

各位早年大概都听说过Parse这家领先的BaaS提供商，它为移动开发提供强有力的后端支持，包括云存储、数据分析、用户关系等等。不过它的命运大概也就是被FB收购之后被家暴中了李阳神功第九重，以至于一年之后暴毙家中。
什么？你没听说过Parse？没听说过BaaS？那xx的LeanCloud呢？都不知道？好吧，不送了您呢。
                &hellip;
                </p>
                <div class="post-list__meta"><time datetime="2017-07-14T16:46:11.000Z" class="post-list__meta--date date">7月 15 2017</time> &#8226; <span class="post-list__meta--tags tags">于&nbsp;
  <a class="tag-link" href="/tags/CloudKit/">CloudKit</a>, <a class="tag-link" href="/tags/iCloud/">iCloud</a>
</span><a class="btn-border-small" href="/2017/07/15/2017-07-10-Begining-CloudKit/">继续阅读</a></div>
                       
            </div>
        
     
   
   
  
</section>

            <footer class="footer">
    <span class="footer__copyright">
        本站点采用 <a href="http://creativecommons.org/licenses/by-nc-sa/4.0/">知识共享署名-非商业性使用-相同方式共享 4.0 国际许可协议</a>
    </span>
    <span class="footer__copyright">
        基于 <a href="http://hexo.io">Hexo</a> 搭建，感谢 <a href="https://pages.github.com/">GitHub Pages</a> 提供免费的托管服务
    </span>
    <span class="footer__copyright">
        &copy; 2018 - 本站使用 <a href="https://github.com/monniya/hexo-theme-new-vno ">new-vno</a> 主题,
        由<a href="https://monniya.com ">@Monniya</a> 修改自 <a href="https://github.com/lenbo-ma/hexo-theme-vno" target="_blank">Vno</a>, 原创出自<a href="http://github.com/onevcat/vno" target="_blank">onevcat</a>
    </span>
    
</footer>


        </div>
    </div>

     
    
    <script>
        var _hmt = _hmt || [];
        (function() {
            var hm = document.createElement("script");
            hm.src = "//hm.baidu.com/hm.js?f1811f144f64379f918cf1ef7bf3f3cb";
            var s = document.getElementsByTagName("script")[0]; 
            s.parentNode.insertBefore(hm, s);
        })();
    </script>



    <script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    
    
</body>
</html>
